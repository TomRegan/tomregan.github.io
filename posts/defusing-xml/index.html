<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Defusing XML | tomregan.github.io</title>
<meta name=keywords content><meta name=description content="XML: the most terrifying thing on the planet
Rule 1 of the Internet— is never, ever trust the Internet. Reading from a socket is the equivalent of putting your hand into an unknown box that&rsquo;s full of snakes, but you don&rsquo;t know it&rsquo;s full of snakes and it ends up pretty touch-and-go as to whether you get out in one piece.
Getting XML over the wire is like that, but more terrifying and more dangerous."><meta name=author content><link rel=canonical href=https://tomregan.github.io/posts/defusing-xml/><link crossorigin=anonymous href=/assets/css/stylesheet.2d57c2ec5c1393c947086a457dd198f941b9476b45ce2a2405529f16729999ae.css integrity="sha256-LVfC7FwTk8lHCGpFfdGY+UG5R2tFziokBVKfFnKZma4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomregan.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomregan.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomregan.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tomregan.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tomregan.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomregan.github.io/posts/defusing-xml/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Defusing XML"><meta property="og:description" content="XML: the most terrifying thing on the planet
Rule 1 of the Internet— is never, ever trust the Internet. Reading from a socket is the equivalent of putting your hand into an unknown box that&rsquo;s full of snakes, but you don&rsquo;t know it&rsquo;s full of snakes and it ends up pretty touch-and-go as to whether you get out in one piece.
Getting XML over the wire is like that, but more terrifying and more dangerous."><meta property="og:type" content="article"><meta property="og:url" content="https://tomregan.github.io/posts/defusing-xml/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-04-15T00:00:00+00:00"><meta property="article:modified_time" content="2013-04-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Defusing XML"><meta name=twitter:description content="XML: the most terrifying thing on the planet
Rule 1 of the Internet— is never, ever trust the Internet. Reading from a socket is the equivalent of putting your hand into an unknown box that&rsquo;s full of snakes, but you don&rsquo;t know it&rsquo;s full of snakes and it ends up pretty touch-and-go as to whether you get out in one piece.
Getting XML over the wire is like that, but more terrifying and more dangerous."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tomregan.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Defusing XML","item":"https://tomregan.github.io/posts/defusing-xml/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Defusing XML","name":"Defusing XML","description":"XML: the most terrifying thing on the planet\nRule 1 of the Internet— is never, ever trust the Internet. Reading from a socket is the equivalent of putting your hand into an unknown box that\u0026rsquo;s full of snakes, but you don\u0026rsquo;t know it\u0026rsquo;s full of snakes and it ends up pretty touch-and-go as to whether you get out in one piece.\nGetting XML over the wire is like that, but more terrifying and more dangerous.","keywords":[],"articleBody":" XML: the most terrifying thing on the planet\nRule 1 of the Internet— is never, ever trust the Internet. Reading from a socket is the equivalent of putting your hand into an unknown box that’s full of snakes, but you don’t know it’s full of snakes and it ends up pretty touch-and-go as to whether you get out in one piece.\nGetting XML over the wire is like that, but more terrifying and more dangerous.\nHere’s one heinous example:\nExponential Entity Expansion By defining entities which form chains that fan out exponentially when they’re dereferenced, the load and memory used on a host can be attacked. It goes a little something like this:\n{% highlight xml %}\n\u003c!DOCTYPE xmlbomb [ \u003c!ENTITY a \"1234567890\" \u003e \u003c!ENTITY b \"\u0026a;\u0026a;\u0026a;\u0026a;\u0026a;\u0026a;\u0026a;\u0026a;\"\u003e \u003c!ENTITY c \"\u0026b;\u0026b;\u0026b;\u0026b;\u0026b;\u0026b;\u0026b;\u0026b;\"\u003e \u003c!ENTITY d \"\u0026c;\u0026c;\u0026c;\u0026c;\u0026c;\u0026c;\u0026c;\u0026c;\"\u003e ]\u003e \u0026d; {% endhighlight %}\nEach reference triggers a growing number of dereferences, turning the few hundred bytes above into a multi gigabyte ordeal.\nExponential entity expansion is about as much fun as a wet fart.\nExternal Entity Expansion More fun along similar lines: using the SYSTEM identifier, an external resource can be loaded and, if you’ve very lucky, end up in a bit of arbitrary code execution.\nWhen the URI is a URL (e.g. a http:// locator) some parsers download the resource from the remote location and embed them into the XML document verbatim. (Explains Christian Heimes.)\nMaybe I’ll start giving these ratings. That one gets 4 / 5 frowny faces.\nDTD Retrieval Nearly identical to External Entity Expansion. But for DTDs. There’s a further variant for local files too, if you aren’t depressed enough.\nPANIC! Thankfully there are lovely libraries (mmmmmm libraries) for python. defusedxml is now available on pypy and there are some good best practices to follow in this python.org blog post.\nAlso worth a read are the following:\nPypy listing for defusedxml Attacking XML Security Message Oriented Madness, XML Worms and Web Service Security Sanity, by Brad Hill (slides, PDF) XML Denial of Service Attacks and Defenses, MSDN ","wordCount":"336","inLanguage":"en","datePublished":"2013-04-15T00:00:00Z","dateModified":"2013-04-15T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomregan.github.io/posts/defusing-xml/"},"publisher":{"@type":"Organization","name":"tomregan.github.io","logo":{"@type":"ImageObject","url":"https://tomregan.github.io/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomregan.github.io/ accesskey=h title="tomregan.github.io (Alt + H)">tomregan.github.io</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://tomregan.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://tomregan.github.io/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tomregan.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://tomregan.github.io/posts/>Posts</a></div><h1 class=post-title>Defusing XML</h1><div class=post-meta><span title='2013-04-15 00:00:00 +0000 UTC'>15 April 2013</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;336 words</div></header><div class=post-content><p><img loading=lazy src=https://gs1.wac.edgecastcdn.net/8019B6/data.tumblr.com/tumblr_m8uhnbZZoM1rzupqxo1_500.png alt></p><p><em>XML: the most terrifying thing on the planet</em></p><p>Rule 1 of the Internet— is never, ever trust the Internet. Reading from a
socket is the equivalent of putting your hand into an unknown box that&rsquo;s full
of snakes, but you don&rsquo;t know it&rsquo;s full of snakes and it ends up pretty
touch-and-go as to whether you get out in one piece.</p><p>Getting XML over the wire is like that, but <em>more</em> terrifying and <em>more</em>
dangerous.</p><p>Here&rsquo;s one heinous example:</p><h3 id=exponential-entity-expansion>Exponential Entity Expansion<a hidden class=anchor aria-hidden=true href=#exponential-entity-expansion>#</a></h3><p>By defining entities which form chains that fan out exponentially when they&rsquo;re
dereferenced, the load and memory used on a host can be attacked.
<a href="https://www.youtube.com/watch?v=s0EcAJZpoZ4">It goes a little something like this</a>:</p><p>{% highlight xml %}</p><!doctype html><p>]>
<bomb>&amp;d;</bomb>
{% endhighlight %}</p><p>Each reference triggers a growing number of dereferences, turning the few
hundred bytes above into a multi gigabyte ordeal.</p><p>Exponential entity expansion is about as much fun as a wet fart.</p><h3 id=external-entity-expansion>External Entity Expansion<a hidden class=anchor aria-hidden=true href=#external-entity-expansion>#</a></h3><p>More fun along similar lines: using the <code>SYSTEM</code> identifier, an external
resource can be loaded and, if you&rsquo;ve very lucky, end up in a bit of arbitrary
code execution.</p><blockquote><p>When the URI is a URL (e.g. a http:// locator) some parsers download the
resource from the remote location and embed them into the XML document
verbatim. (Explains <a href=https://pypi.python.org/pypi/defusedxml/>Christian Heimes</a>.)</p></blockquote><p>Maybe I&rsquo;ll start giving these ratings. That one gets 4 / 5 frowny faces.</p><h3 id=dtd-retrieval>DTD Retrieval<a hidden class=anchor aria-hidden=true href=#dtd-retrieval>#</a></h3><p>Nearly identical to External Entity Expansion. But for DTDs. There&rsquo;s a
further variant for local files too, if you aren&rsquo;t depressed enough.</p><h3 id=panic>PANIC!<a hidden class=anchor aria-hidden=true href=#panic>#</a></h3><p>Thankfully there are lovely libraries (<em>mmmmmm</em> libraries) for python.
<code>defusedxml</code> is now available on pypy and there are some good best
practices to follow in <a href=http://blog.python.org/2013/02/announcing-defusedxml-fixes-for-xml.html>this python.org blog post</a>.</p><p>Also worth a read are the following:</p><ul><li><a href=https://pypi.python.org/pypi/defusedxml/>Pypy listing for defusedxml</a></li><li><a href=https://www.isecpartners.com/media/12976/iSEC-HILL-Attacking-XML-Security-bh07.pdf>Attacking XML Security Message Oriented Madness, XML Worms and Web Service Security Sanity, by Brad Hill</a> (slides, PDF)</li><li><a href=http://msdn.microsoft.com/en-us/magazine/ee335713.aspx>XML Denial of Service Attacks and Defenses, MSDN</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tomregan.github.io/>tomregan.github.io</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>