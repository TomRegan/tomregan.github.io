<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Writing Libraries in Bash | tomregan.github.io</title>
<meta name=keywords content><meta name=description content="If you&rsquo;re a Python programmer, chances are you&rsquo;re familiar with the idiom:
if __name__ == '__main__': main() This lets you put behaviour in a file that will only be executed if it&rsquo;s run from the command line, not when it&rsquo;s included in a program.
So it&rsquo;s possible to achieve the same thing in bash, simply using:
[[ $0 != -${SHELL##*/} ]] && main Could that be clearer? Probably. Here&rsquo;s what it means from left to right:"><meta name=author content><link rel=canonical href=https://tomregan.github.io/posts/writing-libraries-in-bash/><link crossorigin=anonymous href=/assets/css/stylesheet.2d57c2ec5c1393c947086a457dd198f941b9476b45ce2a2405529f16729999ae.css integrity="sha256-LVfC7FwTk8lHCGpFfdGY+UG5R2tFziokBVKfFnKZma4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomregan.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomregan.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomregan.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tomregan.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tomregan.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomregan.github.io/posts/writing-libraries-in-bash/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Writing Libraries in Bash"><meta property="og:description" content="If you&rsquo;re a Python programmer, chances are you&rsquo;re familiar with the idiom:
if __name__ == '__main__': main() This lets you put behaviour in a file that will only be executed if it&rsquo;s run from the command line, not when it&rsquo;s included in a program.
So it&rsquo;s possible to achieve the same thing in bash, simply using:
[[ $0 != -${SHELL##*/} ]] && main Could that be clearer? Probably. Here&rsquo;s what it means from left to right:"><meta property="og:type" content="article"><meta property="og:url" content="https://tomregan.github.io/posts/writing-libraries-in-bash/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-11-19T00:00:00+00:00"><meta property="article:modified_time" content="2013-11-19T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Writing Libraries in Bash"><meta name=twitter:description content="If you&rsquo;re a Python programmer, chances are you&rsquo;re familiar with the idiom:
if __name__ == '__main__': main() This lets you put behaviour in a file that will only be executed if it&rsquo;s run from the command line, not when it&rsquo;s included in a program.
So it&rsquo;s possible to achieve the same thing in bash, simply using:
[[ $0 != -${SHELL##*/} ]] && main Could that be clearer? Probably. Here&rsquo;s what it means from left to right:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tomregan.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Writing Libraries in Bash","item":"https://tomregan.github.io/posts/writing-libraries-in-bash/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Writing Libraries in Bash","name":"Writing Libraries in Bash","description":"If you\u0026rsquo;re a Python programmer, chances are you\u0026rsquo;re familiar with the idiom:\nif __name__ == \u0026#39;__main__\u0026#39;: main() This lets you put behaviour in a file that will only be executed if it\u0026rsquo;s run from the command line, not when it\u0026rsquo;s included in a program.\nSo it\u0026rsquo;s possible to achieve the same thing in bash, simply using:\n[[ $0 != -${SHELL##*/} ]] \u0026amp;\u0026amp; main Could that be clearer? Probably. Here\u0026rsquo;s what it means from left to right:","keywords":[],"articleBody":" If you’re a Python programmer, chances are you’re familiar with the idiom:\nif __name__ == '__main__': main() This lets you put behaviour in a file that will only be executed if it’s run from the command line, not when it’s included in a program.\nSo it’s possible to achieve the same thing in bash, simply using:\n[[ $0 != -${SHELL##*/} ]] \u0026\u0026 main Could that be clearer? Probably. Here’s what it means from left to right:\n[[ are extended conditional tests. Useful if you want to use non-posix operators such as the regex matcher (=~), but in this case the posix conditional [ is directly substitutable. $0 is the zeroth command line argument. In case you’ve just called ./script.bash It’s going to be, you guessed it, script.bash. When we source the same file(source script.bash) the zeroth argument contains an interesting value which will be revealed in a moment. != Not equal, right? -${SHELL##*/} So that interesting value I mentioned when a script is sourced is the name of the shell preceded by a hyphen. If you’re running a bash shell, that will be the value -bash. the $SHELL environment variable contains the path of the current shell, for example /bin/bash. The matcher ##*/ removes the longest string (##) of any characters (*) up to a / from the variable SHELL. In effect this is doing the same thing as basename, but without spawning a subshell. \u0026\u0026 main is just shorthand for if [ true ]; then main; fi, and it means the main function will be called if the condition is true. If you try this on the command line, you’ll see that executing the script directly evaluates the body of main, while sourcing does not.\nThis opens up the possibility to write shared code in executable scripts, and to separate unit tests out from the runnable code. My goal is to write clean, extensible, modular bash.\nCaveats I haven’t tested this with many non-bash shells. If you’re the kind of devient who uses zsh, korn, or an even less savoury offering, this may not work for you. I have used this successfully running bash 3, 4 and on busybox using the ash shell. I have a hazy understanding of source so I can imagine a few failure cases in multi-shell environments where the primary shell is not bash. If anyone can suggest a better solution, do contact me. ","wordCount":"399","inLanguage":"en","datePublished":"2013-11-19T00:00:00Z","dateModified":"2013-11-19T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomregan.github.io/posts/writing-libraries-in-bash/"},"publisher":{"@type":"Organization","name":"tomregan.github.io","logo":{"@type":"ImageObject","url":"https://tomregan.github.io/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomregan.github.io/ accesskey=h title="tomregan.github.io (Alt + H)">tomregan.github.io</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://tomregan.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://tomregan.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tomregan.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://tomregan.github.io/posts/>Posts</a></div><h1 class=post-title>Writing Libraries in Bash</h1><div class=post-meta><span title='2013-11-19 00:00:00 +0000 UTC'>19 November 2013</span>&nbsp;·&nbsp;399 words</div></header><div class=post-content><p>If you&rsquo;re a Python programmer, chances are you&rsquo;re familiar with the idiom:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p>This lets you put behaviour in a file that will only be executed if it&rsquo;s run
from the command line, not when it&rsquo;s included in a program.</p><p>So it&rsquo;s possible to achieve the same thing in bash, simply using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[[</span> $0 !<span style=color:#f92672>=</span> -<span style=color:#e6db74>${</span>SHELL##*/<span style=color:#e6db74>}</span> <span style=color:#f92672>]]</span> <span style=color:#f92672>&amp;&amp;</span> main
</span></span></code></pre></div><p>Could that be clearer? Probably. Here&rsquo;s what it means from left to right:</p><ul><li><code>[[</code> are extended conditional tests. Useful if you want to use non-posix
operators
such as the regex matcher (<code>=~</code>), but in this case the posix conditional
<code>[</code> is directly substitutable.</li><li><code>$0</code> is the zeroth command line argument. In case you&rsquo;ve just called
<code>./script.bash</code> It&rsquo;s going to be, you guessed it, <code>script.bash</code>. When we
source the same file(<code>source script.bash</code>) the zeroth argument contains an
interesting value which will be revealed in a moment.</li><li><code>!=</code> Not equal, right?</li><li><code>-${SHELL##*/}</code> So that <em>interesting value</em> I mentioned when a script is
sourced is the
name of the shell preceded by a hyphen. If you&rsquo;re running a bash shell, that
will be the value <code>-bash</code>. the <code>$SHELL</code> environment variable contains the
path of the current shell, for example <code>/bin/bash</code>. The matcher <code>##*/</code> removes
the longest string (<code>##</code>) of any characters (<code>*</code>) up to a <code>/</code> from the variable
<code>SHELL</code>. In effect this is doing the same thing as <code>basename</code>, but without
spawning a subshell.</li><li><code>&& main</code> is just shorthand for <code>if [ true ]; then main; fi</code>, and it means
the main function will be called if the condition is true.</li></ul><p>If you try this on the command line, you&rsquo;ll see that executing the script
directly evaluates the body of main, while sourcing does not.</p><p>This opens up the possibility to write shared code in executable scripts,
and to separate unit tests out from the runnable code. My goal is to write
clean, extensible, modular bash.</p><h3 id=caveats>Caveats<a hidden class=anchor aria-hidden=true href=#caveats>#</a></h3><ul><li>I haven&rsquo;t tested this with many non-bash shells. If you&rsquo;re the kind of
devient who uses zsh, korn, or an even less savoury offering, this may not
work for you.</li><li>I have used this successfully running bash 3, 4 and on busybox using the
ash shell.</li><li>I have a hazy understanding of <code>source</code> so I can imagine a few failure cases
in multi-shell environments where the primary shell is not bash. If anyone can
suggest a better solution, do contact me.</li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tomregan.github.io/>tomregan.github.io</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>