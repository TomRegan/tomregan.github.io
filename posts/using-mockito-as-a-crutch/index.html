<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Mockito as a Crutch | tomregan.github.io</title>
<meta name=keywords content><meta name=description content="&ldquo;omne trium perfectum&rdquo;, as the Latins used to say: a set of three is perfect. Sadly I don&rsquo;t have three facts I know about mockito, but I do have two facts. That&rsquo;s not enough to impress anyone, which means almost by definition, it&rsquo;s enough for a blog.
Returning different values from a mock on successive calls This is so basic, I expect I&rsquo;m the last person to hear about it. I stumbled on it while trying to mock an Enumeration."><meta name=author content><link rel=canonical href=https://tomregan.github.io/posts/using-mockito-as-a-crutch/><link crossorigin=anonymous href=/assets/css/stylesheet.2d57c2ec5c1393c947086a457dd198f941b9476b45ce2a2405529f16729999ae.css integrity="sha256-LVfC7FwTk8lHCGpFfdGY+UG5R2tFziokBVKfFnKZma4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomregan.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomregan.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomregan.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tomregan.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tomregan.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomregan.github.io/posts/using-mockito-as-a-crutch/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Using Mockito as a Crutch"><meta property="og:description" content="&ldquo;omne trium perfectum&rdquo;, as the Latins used to say: a set of three is perfect. Sadly I don&rsquo;t have three facts I know about mockito, but I do have two facts. That&rsquo;s not enough to impress anyone, which means almost by definition, it&rsquo;s enough for a blog.
Returning different values from a mock on successive calls This is so basic, I expect I&rsquo;m the last person to hear about it. I stumbled on it while trying to mock an Enumeration."><meta property="og:type" content="article"><meta property="og:url" content="https://tomregan.github.io/posts/using-mockito-as-a-crutch/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-08-28T00:00:00+00:00"><meta property="article:modified_time" content="2013-08-28T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Mockito as a Crutch"><meta name=twitter:description content="&ldquo;omne trium perfectum&rdquo;, as the Latins used to say: a set of three is perfect. Sadly I don&rsquo;t have three facts I know about mockito, but I do have two facts. That&rsquo;s not enough to impress anyone, which means almost by definition, it&rsquo;s enough for a blog.
Returning different values from a mock on successive calls This is so basic, I expect I&rsquo;m the last person to hear about it. I stumbled on it while trying to mock an Enumeration."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tomregan.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Using Mockito as a Crutch","item":"https://tomregan.github.io/posts/using-mockito-as-a-crutch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Mockito as a Crutch","name":"Using Mockito as a Crutch","description":"\u0026ldquo;omne trium perfectum\u0026rdquo;, as the Latins used to say: a set of three is perfect. Sadly I don\u0026rsquo;t have three facts I know about mockito, but I do have two facts. That\u0026rsquo;s not enough to impress anyone, which means almost by definition, it\u0026rsquo;s enough for a blog.\nReturning different values from a mock on successive calls This is so basic, I expect I\u0026rsquo;m the last person to hear about it. I stumbled on it while trying to mock an Enumeration.","keywords":[],"articleBody":"“omne trium perfectum”, as the Latins used to say: a set of three is perfect. Sadly I don’t have three facts I know about mockito, but I do have two facts. That’s not enough to impress anyone, which means almost by definition, it’s enough for a blog.\nReturning different values from a mock on successive calls This is so basic, I expect I’m the last person to hear about it. I stumbled on it while trying to mock an Enumeration. The thenReturn method takes an array of objects which will be returned over subsequent calls, for example:\n{% highlight java %} Enumeration myEnumeration = mock(Enumeration.class); when(myEnumeration.hasMoreElements()).thenReturn(true, true, true, true, false); when(myEnumeration.nextElement()).thenReturn(new Integer(3), new Integer(5));\n// …\nwhile(myEnumeration.hasMoreElements()) { myEnumeration.nextElement(); // returns 3, 5, 3, 5 } {% endhighlight %}\nThe return value will wrap over the given parameters, so the third call to nextElement will return the zeroth parameter and so on. This is a really clean way of mocking objects with simple, predictable behaviour.\nIntegrating an existing object with complex behaviour In the code I’m working on, our configuration is passed around as a properties object. It’s pretty clear that every time a developer has been called upon to support some new configuration, they’ve created a wrapper object somewhere in the code base close to where it’s needed. This is kind of horrible for three reasons:\nthe same configuration is used in multiple places, so we end up with multiple instances of some of these objects;\nsupporting a new configuration format means duplicating lots of logic that determines how to access the new config, and when to fall back to the old config\nTHE DEPENDENCIES, OH GOD, THE DEPENDENCIES!\nI went with creating a composite of old and new configuration, and where behaviour contained in supporting objects was too complex to refactor in a reasonable amount of time, I wrapped it with the composite configuration object to hide it from the rest of the system.\nMockito’s thenAnswer method lets you model arbitrary behaviour in response to a method call on a mock. This example passes an argument to an existing class.\n{% highlight java %} NewConfiguration config = mock(NewConfiguration.class); // mock new class when(config.doComplexThing(anyString())).thenAsnwer(new Answer() { Object answer(InvocationOnMock invocation) { new ExistingObject().doComplexThing(invocation.getArguments()[0])); // call existing method } }); {% endhighlight %}\nI’m not advocating these techniques for doing clean TDD, but they’re good tools for cleaning up existing code.\n","wordCount":"400","inLanguage":"en","datePublished":"2013-08-28T00:00:00Z","dateModified":"2013-08-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomregan.github.io/posts/using-mockito-as-a-crutch/"},"publisher":{"@type":"Organization","name":"tomregan.github.io","logo":{"@type":"ImageObject","url":"https://tomregan.github.io/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomregan.github.io/ accesskey=h title="tomregan.github.io (Alt + H)">tomregan.github.io</a><div class=logo-switches><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://tomregan.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://tomregan.github.io/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tomregan.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://tomregan.github.io/posts/>Posts</a></div><h1 class=post-title>Using Mockito as a Crutch</h1><div class=post-meta>&lt;span title='2013-08-28 00:00:00 +0000 UTC'>August 28, 2013&lt;/span>&amp;nbsp;·&amp;nbsp;2 min&amp;nbsp;·&amp;nbsp;400 words</div></header><div class=post-content><p><em>&ldquo;omne trium perfectum&rdquo;</em>, as the Latins used to say: a set of three is perfect. Sadly I don&rsquo;t have three facts I know about <a href=http://code.google.com/p/mockito/>mockito</a>,
but I do have two facts. That&rsquo;s not enough to impress anyone, which means
almost by definition, it&rsquo;s enough for a blog.</p><h3 id=returning-different-values-from-a-mock-on-successive-calls>Returning different values from a mock on successive calls<a hidden class=anchor aria-hidden=true href=#returning-different-values-from-a-mock-on-successive-calls>#</a></h3><p>This is so basic, I expect I&rsquo;m the last person to hear about it.
I stumbled on it while trying to mock an <a href=http://docs.oracle.com/javase/6/docs/api/java/util/Enumeration.html><code>Enumeration</code></a>. The <code>thenReturn</code>
method takes an array of objects which will be returned over subsequent
calls, for example:</p><p>{% highlight java %}
Enumeration myEnumeration = mock(Enumeration.class);
when(myEnumeration.hasMoreElements()).thenReturn(true, true, true, true, false);
when(myEnumeration.nextElement()).thenReturn(new Integer(3), new Integer(5));</p><p>// &mldr;</p><p>while(myEnumeration.hasMoreElements()) {
myEnumeration.nextElement(); // returns 3, 5, 3, 5
}
{% endhighlight %}</p><p>The return value will wrap over the given parameters, so the third call to
<code>nextElement</code> will return the zeroth parameter and so on. This is a really
clean way of mocking objects with simple, predictable behaviour.</p><h3 id=integrating-an-existing-object-with-complex-behaviour>Integrating an existing object with complex behaviour<a hidden class=anchor aria-hidden=true href=#integrating-an-existing-object-with-complex-behaviour>#</a></h3><p>In the code I&rsquo;m working on, our configuration is passed around as a
<code>properties</code> object. It&rsquo;s pretty clear that every time a developer has
been called upon to support some new configuration, they&rsquo;ve created a
wrapper object somewhere in the code base close to where it&rsquo;s needed.
This is kind of horrible for three reasons:</p><ol><li><p>the same configuration is used in multiple places, so we end up with
multiple instances of some of these objects;</p></li><li><p>supporting a new configuration format means duplicating lots of
logic that determines how to access the new config, and when to
fall back to the old config</p></li><li><p>THE DEPENDENCIES, OH GOD, THE DEPENDENCIES!</p></li></ol><p>I went with creating a composite of old and new configuration, and
where behaviour contained in supporting objects was too complex to
refactor in a reasonable amount of time, I wrapped it with the composite
configuration object to hide it from the rest of the system.</p><p>Mockito&rsquo;s <code>thenAnswer</code> method lets you model arbitrary behaviour
in response to a method call on a mock. This example passes an argument
to an existing class.</p><p>{% highlight java %}
NewConfiguration config = mock(NewConfiguration.class); // mock new class
when(config.doComplexThing(anyString())).thenAsnwer(new Answer() {
Object answer(InvocationOnMock invocation) {
new ExistingObject().doComplexThing(invocation.getArguments()[0])); // call existing method
}
});
{% endhighlight %}</p><p>I&rsquo;m not advocating these techniques for doing clean TDD, but they&rsquo;re good
tools for cleaning up existing code.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tomregan.github.io/>tomregan.github.io</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>