<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Unit Testing in C with Check - Setting Up a Project | tomregan.github.io</title>
<meta name=keywords content><meta name=description content="In a previous post I went through the steps to run the Check tutorial, had a bit of a whinge about how difficult is had all been, and mumbled a bit about coming back when I&rsquo;d figured out how to make everything work on a real project. In fact, that was much simpler than I expected.
At the end of this, I&rsquo;ll have a simple C program with a corresponding build that uses the Check testing framework."><meta name=author content><link rel=canonical href=https://tomregan.github.io/posts/unit-testing-in-c-with-check-setting-up-a-project/><link crossorigin=anonymous href=/assets/css/stylesheet.2d57c2ec5c1393c947086a457dd198f941b9476b45ce2a2405529f16729999ae.css integrity="sha256-LVfC7FwTk8lHCGpFfdGY+UG5R2tFziokBVKfFnKZma4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomregan.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomregan.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomregan.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tomregan.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tomregan.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomregan.github.io/posts/unit-testing-in-c-with-check-setting-up-a-project/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Unit Testing in C with Check - Setting Up a Project"><meta property="og:description" content="In a previous post I went through the steps to run the Check tutorial, had a bit of a whinge about how difficult is had all been, and mumbled a bit about coming back when I&rsquo;d figured out how to make everything work on a real project. In fact, that was much simpler than I expected.
At the end of this, I&rsquo;ll have a simple C program with a corresponding build that uses the Check testing framework."><meta property="og:type" content="article"><meta property="og:url" content="https://tomregan.github.io/posts/unit-testing-in-c-with-check-setting-up-a-project/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-08-27T00:00:00+00:00"><meta property="article:modified_time" content="2012-08-27T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Unit Testing in C with Check - Setting Up a Project"><meta name=twitter:description content="In a previous post I went through the steps to run the Check tutorial, had a bit of a whinge about how difficult is had all been, and mumbled a bit about coming back when I&rsquo;d figured out how to make everything work on a real project. In fact, that was much simpler than I expected.
At the end of this, I&rsquo;ll have a simple C program with a corresponding build that uses the Check testing framework."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tomregan.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Unit Testing in C with Check - Setting Up a Project","item":"https://tomregan.github.io/posts/unit-testing-in-c-with-check-setting-up-a-project/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Unit Testing in C with Check - Setting Up a Project","name":"Unit Testing in C with Check - Setting Up a Project","description":"In a previous post I went through the steps to run the Check tutorial, had a bit of a whinge about how difficult is had all been, and mumbled a bit about coming back when I\u0026rsquo;d figured out how to make everything work on a real project. In fact, that was much simpler than I expected.\nAt the end of this, I\u0026rsquo;ll have a simple C program with a corresponding build that uses the Check testing framework.","keywords":[],"articleBody":"In a previous post I went through the steps to run the Check tutorial, had a bit of a whinge about how difficult is had all been, and mumbled a bit about coming back when I’d figured out how to make everything work on a real project. In fact, that was much simpler than I expected.\nAt the end of this, I’ll have a simple C program with a corresponding build that uses the Check testing framework.\nInstall Check One of the nice things about Check is that you can find it in a lot of repositories. Ubuntu, CentOS and MacPorts all have a check package, but in the worst case you may have to compile it for your platform.\nI’m starting out with a fresh Ubuntu install, so I could install Check with apt-get, but for the sake of it, I’m going to compile it instead. First I needed to get a bit of a tool chain set up:\napt-get install git build-essential curl Then, I downloaded Check from sourceforge.net:\ncurl -L \"http://downloads.sourceforge.net/project/check/check/0.9.8/check-0.9.8.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fcheck%2Ffiles%2F\u0026ts=1346064997\u0026use_mirror=switch\" \u003e check-0.9.8.tar.gz I unzipped check-0.9.8.tar.gz and built it. The Check build uses autotools, which is a build technology for people who want to collaborate, but with people they don’t like very much. Check’s other dependencies are listed in the readme.\napt-get install automake autoconf libtool pkg-config texinfo Then I built Check.\nautoreconf --install ./configure make make install I’m mainly interested in the headers and libraries, which the installation puts in /usr/local/include and /usr/local/lib.\nDuring the build, I need to make sure that /usr/local/include is on the include path, and /usr/local/lib on the library path. If I was building manually with make I would use make -L /usr/local/lib -I /usr/local/include. Instead I’ll add this to the makefile.\n###Create a Project\nI created a project folder containing src, test, include and lib directories with:\nmkdir -p project/{src,test,include,lib} and created the following root makefile in the project directory:\n{% highlight make %} all: +$(MAKE) -C src +$(MAKE) -C test\ncheck: +$(MAKE) -C test check\nclean: +$(MAKE) -C src clean +$(MAKE) -C test clean {% endhighlight %}\nI wrote a simple C function to test some implementation:\n{% highlight c %} const char* greet(const char *name) { return “”; } {% endhighlight %}\nand a corresponding header:\n{% highlight c %} const char* greet(const char *); {% endhighlight %}\nplus a main method.\n{% highlight c %} #include #include “greet.h”\nint main(void) { puts(greet(“Tom”)); return 0; } {% endhighlight %}\nThe following Makefile lives in src, and is called by the root makefile:\n{% highlight make %} program_NAME := main program_SRCS := $(wildcard *.c) program_OBJS := ${program_SRCS:.c=.o}\nCFLAGS += -I ../include\n.PHONY: all clean\nall: $(program_NAME)\n$(program_NAME): $(program_OBJS) $(CC) $(CFLAGS) -o $(program_NAME) $(program_OBJS) cp greet.o ../lib\nclean: $(RM) $(program_NAME) $(program_OBJS) {% endhighlight %}\nI wrote a simple failing test with no implementation:\n{% highlight c %} #include #include START_TEST (check_correct_greeting_is_returned) { fail(“test not implemented”); } END_TEST {% endhighlight %}\nand then, a more complicated test runner. There’s no requirement to separate the test runner out from the test suites, but I prefer it.\n{% highlight c %} #include #include “check_main.c”\nSuite * request_suite(void) { Suite *s = suite_create(“request”);\nTCase *tc_core = tcase_create(\"Core\"); tcase_add_test(tc_core, check_correct_greeting_is_returned); suite_add_tcase(s, tc_core); return s; }\nint main(void) { int number_failed; Suite *s = request_suite(); SRunner *sr = srunner_create(s); srunner_run_all(sr, CK_NORMAL); number_failed = srunner_ntests_failed(sr); srunner_free(sr);\nreturn (number_failed == 0) ? 0 : 1; } {% endhighlight %}\nI based test_runner.c on some example code I found in the Check documentation which you can see here.\nThe test Makefile looks like this:\n{% highlight make %} check_NAME := test_runner check_SRCS := $(wildcard *.c) check_OBJS := ${check_SRCS:.c=.o} check_LIBS := -lcheck\nprogram_OBJS := $(wildcard ../lib/*.o)\nCFLAGS += -L/usr/local/lib -I/usr/local/include -I../include\n.PHONY: all clean check\nall: $(check_NAME)\n$(check_NAME): $(check_OBJS) $(CC) $(CFLAGS) -o $(check_NAME) $(check_OBJS) $(program_OBJS) $(check_LIBS)\ncheck: all ./test_runner\nclean: $(RM) $(check_NAME) $(check_OBJS) {% endhighlight %}\nNow I can run make check to see the unit test working, i.e. failing.\nvagrant@precise64:~/Development/project$ make check make -C test check make[1]: Entering directory `/home/vagrant/Development/project/test' cc -L/usr/local/lib -I/usr/local/include -I../include -c -o check_main.o check_main.c cc -L/usr/local/lib -I/usr/local/include -I../include -c -o test_runner.o test_runner.c cc -L/usr/local/lib -I/usr/local/include -I../include -o test_runner check_main.o test_runner.o ../lib/greet.o -lcheck ./test_runner Running suite(s): request 0%: Checks: 1, Failures: 1, Errors: 0 check_main.c:7:F:Core:check_correct_greeting_is_returned:0: test not implemented make[1]: *** [check] Error 1 make[1]: Leaving directory `/home/vagrant/Development/project/test' make: *** [check] Error 2 ###Code some code\nFinally, I did some of that programming stuff to make the program do what I expect, which is to greet me with “ohai Tom! xxx”.\n{% highlight diff %} #include +#include #include START_TEST (check_correct_greeting_is_returned) {\nfail(\"test not implemented\"); fail_unless(0 == strncmp(\"ohai Tom! xxx\", greet(\"Tom\"), (size_t) 255)); } END_TEST {% endhighlight %}\nNow my test fails with an assertion error:\nvagrant@precise64:~/Development/project$ make check make -C test check make[1]: Entering directory `/home/vagrant/Development/project/test' ./test_runner Running suite(s): request 0%: Checks: 1, Failures: 1, Errors: 0 check_main.c:8:F:Core:check_correct_greeting_is_returned:0: Assertion '0 == strncmp(\"ohai Tom! xxx\", greet(\"Tom\"), (size_t) 255)' failed make[1]: *** [check] Error 1 make[1]: Leaving directory `/home/vagrant/Development/project/test' make: *** [check] Error 2 Because TDD is all about writing the simplest code to pass the test, my implementation is as follows:\n{% highlight diff %} — a/src/greet.c +++ b/src/greet.c @@ -1,5 +1,5 @@ const char* greet(const char *name) {\nreturn \"\"; return \"ohai Tom! xxx\"; } {% endhighlight %}\nMerci beaucoup, et bonne nuit.\nYou can download the simple project here, or check out my pet project, pushy, on github for a more realistic example.\n","wordCount":"913","inLanguage":"en","datePublished":"2012-08-27T00:00:00Z","dateModified":"2012-08-27T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomregan.github.io/posts/unit-testing-in-c-with-check-setting-up-a-project/"},"publisher":{"@type":"Organization","name":"tomregan.github.io","logo":{"@type":"ImageObject","url":"https://tomregan.github.io/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomregan.github.io/ accesskey=h title="tomregan.github.io (Alt + H)">tomregan.github.io</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://tomregan.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://tomregan.github.io/categories/ title=Categories><span>Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tomregan.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://tomregan.github.io/posts/>Posts</a></div><h1 class=post-title>Unit Testing in C with Check - Setting Up a Project</h1><div class=post-meta><span title='2012-08-27 00:00:00 +0000 UTC'>27 August 2012</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;913 words</div></header><div class=post-content><p>In a <a href=blog/2012/08/12/unit-testing-in-c-with-check>previous post</a>
I went through the steps to run the
<a href=http://check.sourceforge.net/>Check</a>
tutorial, had a bit of a whinge about how difficult
is had all been, and mumbled a bit about coming back when I&rsquo;d figured
out how to make everything work on a real project. In fact, that
was much simpler than I expected.</p><p>At the end of this, I&rsquo;ll have a simple C program with a corresponding
build that uses the Check testing framework.</p><h3 id=install-check>Install Check<a hidden class=anchor aria-hidden=true href=#install-check>#</a></h3><p>One of the nice things about Check is that you can find it in a lot
of repositories. Ubuntu, CentOS and MacPorts all have a <code>check</code>
package, but in the worst case you may have to compile it for your
platform.</p><p>I&rsquo;m starting out with a fresh Ubuntu install, so I could install Check
with <code>apt-get</code>, but for the sake of it, I&rsquo;m going to compile it instead.
First I needed to get a bit of a tool chain set up:</p><pre><code>apt-get install git build-essential curl
</code></pre><p>Then, I downloaded Check from <a href=http://sourceforge.net/projects/check/>sourceforge.net</a>:</p><pre><code>curl -L &quot;http://downloads.sourceforge.net/project/check/check/0.9.8/check-0.9.8.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fcheck%2Ffiles%2F&amp;ts=1346064997&amp;use_mirror=switch&quot; &gt; check-0.9.8.tar.gz
</code></pre><p>I unzipped <code>check-0.9.8.tar.gz</code> and built it. The Check build uses
autotools, which is a build technology for people who want to
collaborate, but with people they don&rsquo;t like very much.
Check&rsquo;s other dependencies are listed in the readme.</p><pre><code>apt-get install automake autoconf libtool pkg-config texinfo
</code></pre><p>Then I built Check.</p><pre><code>autoreconf --install
./configure
make
make install
</code></pre><p>I&rsquo;m mainly interested in the headers and libraries, which the installation
puts in <code>/usr/local/include</code> and <code>/usr/local/lib</code>.</p><p>During the build, I need to make sure that <code>/usr/local/include</code> is on the
include path, and <code>/usr/local/lib</code> on the library path.
If I was building manually with <code>make</code> I would use
<code>make -L /usr/local/lib -I /usr/local/include</code>. Instead I&rsquo;ll add this
to the makefile.</p><p>###Create a Project</p><p>I created a <code>project</code> folder containing <code>src</code>, <code>test</code>, <code>include</code> and
<code>lib</code> directories with:</p><pre><code>mkdir -p project/{src,test,include,lib}
</code></pre><p>and created the following root makefile in the <code>project</code> directory:</p><p>{% highlight make %}
all:
+$(MAKE) -C src
+$(MAKE) -C test</p><p>check:
+$(MAKE) -C test check</p><p>clean:
+$(MAKE) -C src clean
+$(MAKE) -C test clean
{% endhighlight %}</p><p>I wrote a simple C function to test some implementation:</p><p>{% highlight c %}
const char*
greet(const char *name)
{
return &ldquo;&rdquo;;
}
{% endhighlight %}</p><p>and a corresponding header:</p><p>{% highlight c %}
const char* greet(const char *);
{% endhighlight %}</p><p>plus a main method.</p><p>{% highlight c %}
#include &lt;stdio.h>
#include &ldquo;greet.h&rdquo;</p><p>int
main(void)
{
puts(greet(&ldquo;Tom&rdquo;));
return 0;
}
{% endhighlight %}</p><p>The following <code>Makefile</code> lives in <code>src</code>, and is called by the root
makefile:</p><p>{% highlight make %}
program_NAME := main
program_SRCS := $(wildcard *.c)
program_OBJS := ${program_SRCS:.c=.o}</p><p>CFLAGS += -I ../include</p><p>.PHONY: all clean</p><p>all: $(program_NAME)</p><p>$(program_NAME): $(program_OBJS)
$(CC) $(CFLAGS) -o $(program_NAME) $(program_OBJS)
cp greet.o ../lib</p><p>clean:
$(RM) $(program_NAME) $(program_OBJS)
{% endhighlight %}</p><p>I wrote a simple failing test with no implementation:</p><p>{% highlight c %}
#include &lt;check.h>
#include &lt;greet.h></p><p>START_TEST (check_correct_greeting_is_returned)
{
fail(&ldquo;test not implemented&rdquo;);
}
END_TEST
{% endhighlight %}</p><p>and then, a more complicated test runner. There&rsquo;s no requirement to
separate the test runner out from the test suites, but I prefer it.</p><p>{% highlight c %}
#include &lt;check.h>
#include &ldquo;check_main.c&rdquo;</p><p>Suite *
request_suite(void)
{
Suite *s = suite_create(&ldquo;request&rdquo;);</p><pre><code>TCase *tc_core = tcase_create(&quot;Core&quot;);
tcase_add_test(tc_core, check_correct_greeting_is_returned);
suite_add_tcase(s, tc_core);

return s;
</code></pre><p>}</p><p>int
main(void)
{
int number_failed;
Suite *s = request_suite();
SRunner *sr = srunner_create(s);
srunner_run_all(sr, CK_NORMAL);
number_failed = srunner_ntests_failed(sr);
srunner_free(sr);</p><pre><code>return (number_failed == 0) ? 0 : 1;
</code></pre><p>}
{% endhighlight %}</p><p>I based <code>test_runner.c</code> on some example code I found in the Check
documentation which you can see <a href=http://check.sourceforge.net/doc/check_html/check_3.html#SEC8>here</a>.</p><p>The test <code>Makefile</code> looks like this:</p><p>{% highlight make %}
check_NAME := test_runner
check_SRCS := $(wildcard *.c)
check_OBJS := ${check_SRCS:.c=.o}
check_LIBS := -lcheck</p><p>program_OBJS := $(wildcard ../lib/*.o)</p><p>CFLAGS += -L/usr/local/lib -I/usr/local/include -I../include</p><p>.PHONY: all clean check</p><p>all: $(check_NAME)</p><p>$(check_NAME): $(check_OBJS)
$(CC) $(CFLAGS) -o $(check_NAME) $(check_OBJS) $(program_OBJS) $(check_LIBS)</p><p>check: all
./test_runner</p><p>clean:
$(RM) $(check_NAME) $(check_OBJS)
{% endhighlight %}</p><p>Now I can run <code>make check</code> to see the unit test working, i.e. failing.</p><pre><code>vagrant@precise64:~/Development/project$ make check
make -C test check
make[1]: Entering directory `/home/vagrant/Development/project/test'
cc -L/usr/local/lib -I/usr/local/include -I../include   -c -o check_main.o check_main.c
cc -L/usr/local/lib -I/usr/local/include -I../include   -c -o test_runner.o test_runner.c
cc -L/usr/local/lib -I/usr/local/include -I../include -o test_runner check_main.o test_runner.o ../lib/greet.o -lcheck
./test_runner
Running suite(s): request
0%: Checks: 1, Failures: 1, Errors: 0
check_main.c:7:F:Core:check_correct_greeting_is_returned:0: test not implemented
make[1]: *** [check] Error 1
make[1]: Leaving directory `/home/vagrant/Development/project/test'
make: *** [check] Error 2
</code></pre><p>###Code some code</p><p>Finally, I did some of that programming stuff to make the program do what
I expect, which is to greet me with <em><a href=http://www.highhatstudios.com/imgs_ext/lolrats/macros/ohai.jpg>&ldquo;ohai Tom! xxx&rdquo;</a></em>.</p><p>{% highlight diff %}
#include &lt;check.h>
+#include &lt;string.h>
#include &lt;greet.h></p><p>START_TEST (check_correct_greeting_is_returned)
{</p><ul><li><pre><code>  fail(&quot;test not implemented&quot;);
</code></pre></li></ul><ul><li><pre><code>  fail_unless(0 == strncmp(&quot;ohai Tom! xxx&quot;, greet(&quot;Tom&quot;), (size_t) 255));
</code></pre></li></ul><p>}
END_TEST
{% endhighlight %}</p><p>Now my test fails with an assertion error:</p><pre><code>vagrant@precise64:~/Development/project$ make check
make -C test check
make[1]: Entering directory `/home/vagrant/Development/project/test'
./test_runner
Running suite(s): request
0%: Checks: 1, Failures: 1, Errors: 0
check_main.c:8:F:Core:check_correct_greeting_is_returned:0: Assertion '0 == strncmp(&quot;ohai Tom! xxx&quot;, greet(&quot;Tom&quot;), (size_t) 255)' failed
make[1]: *** [check] Error 1
make[1]: Leaving directory `/home/vagrant/Development/project/test'
make: *** [check] Error 2
</code></pre><p>Because <a href=http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd>TDD</a>
is all about writing the simplest code to pass the test, my
implementation is as follows:</p><p>{% highlight diff %}
&mdash; a/src/greet.c
+++ b/src/greet.c
@@ -1,5 +1,5 @@
const char*
greet(const char *name)
{</p><ul><li><pre><code>  return &quot;&quot;;
</code></pre></li></ul><ul><li><pre><code>  return &quot;ohai Tom! xxx&quot;;
</code></pre></li></ul><p>}
{% endhighlight %}</p><p><em>Merci beaucoup, et bonne nuit</em>.</p><p>You can download the simple project <a href=downloads/code/simple-check-project.tar.gz>here</a>,
or check out my pet project, <a href=https://github.com/TomRegan/pushy>pushy, on github</a>
for a more realistic example.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tomregan.github.io/>tomregan.github.io</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>