<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Jackson Deduction to Simplify Deserialisation | tomregan.github.io</title>
<meta name=keywords content="java,jackson"><meta name=description content="I find the documentation for Jackson is on the terse side, and dare I say obstructively self-referential. If you aren&rsquo;t moved fully to tears by the Javadoc entries for JsonTypeInfo.As, you deserve an ACM award.
In short: I need a helpful and up-to-date guide, so I&rsquo;m writing one.
What are we trying to do? We often want to vary the content of our JSON. It&rsquo;s integral to the Envelope pattern for instance."><meta name=author content><link rel=canonical href=https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/using-jackson-deduction-to-simplify-deserialisation/><link crossorigin=anonymous href=/assets/css/stylesheet.2d57c2ec5c1393c947086a457dd198f941b9476b45ce2a2405529f16729999ae.css integrity="sha256-LVfC7FwTk8lHCGpFfdGY+UG5R2tFziokBVKfFnKZma4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomregan.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomregan.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomregan.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tomregan.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tomregan.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/using-jackson-deduction-to-simplify-deserialisation/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Using Jackson Deduction to Simplify Deserialisation"><meta property="og:description" content="I find the documentation for Jackson is on the terse side, and dare I say obstructively self-referential. If you aren&rsquo;t moved fully to tears by the Javadoc entries for JsonTypeInfo.As, you deserve an ACM award.
In short: I need a helpful and up-to-date guide, so I&rsquo;m writing one.
What are we trying to do? We often want to vary the content of our JSON. It&rsquo;s integral to the Envelope pattern for instance."><meta property="og:type" content="article"><meta property="og:url" content="https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/using-jackson-deduction-to-simplify-deserialisation/"><meta property="og:image" content="https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/cover.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-30T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-30T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/cover.jpeg"><meta name=twitter:title content="Using Jackson Deduction to Simplify Deserialisation"><meta name=twitter:description content="I find the documentation for Jackson is on the terse side, and dare I say obstructively self-referential. If you aren&rsquo;t moved fully to tears by the Javadoc entries for JsonTypeInfo.As, you deserve an ACM award.
In short: I need a helpful and up-to-date guide, so I&rsquo;m writing one.
What are we trying to do? We often want to vary the content of our JSON. It&rsquo;s integral to the Envelope pattern for instance."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tomregan.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Using Jackson Deduction to Simplify Deserialisation","item":"https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/using-jackson-deduction-to-simplify-deserialisation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Jackson Deduction to Simplify Deserialisation","name":"Using Jackson Deduction to Simplify Deserialisation","description":"I find the documentation for Jackson is on the terse side, and dare I say obstructively self-referential. If you aren\u0026rsquo;t moved fully to tears by the Javadoc entries for JsonTypeInfo.As, you deserve an ACM award.\nIn short: I need a helpful and up-to-date guide, so I\u0026rsquo;m writing one.\nWhat are we trying to do? We often want to vary the content of our JSON. It\u0026rsquo;s integral to the Envelope pattern for instance.","keywords":["java","jackson"],"articleBody":"I find the documentation for Jackson is on the terse side, and dare I say obstructively self-referential. If you aren’t moved fully to tears by the Javadoc entries for JsonTypeInfo.As, you deserve an ACM award.\nIn short: I need a helpful and up-to-date guide, so I’m writing one.\nWhat are we trying to do? We often want to vary the content of our JSON. It’s integral to the Envelope pattern for instance. Varying the content looks like this.\nHere’s an example of an intergalactic animal.\n{ \"created\": \"1977-05-25T12:00:00Z\", \"animal\": { \"galaxy\": \"Far Far Away\", \"name\": \"Womp Rat\" } } And here’s an example of a provincial animal.\n{ \"created\": \"1835-09-15T06:00:00Z\", \"animal\": { \"province\": \"Galápagos Islands\", \"name\": \"Galápagos tortoise\" } } In our Java code, we want to be able to deserialise Animals, and we want to handle either IntergalacticAnimals, or ProvincialAnimals. We might write some transport code that looks like this.\nrecord AnimalSpottedEvent\u003cA extends Animal\u003e(Instant created, A animal) {} interface Animal {} record IntergalacticAnimal(String galaxy, String name) implements Animal {} record ProvincialAnimal(String province, String name) implements Animal {} When it’s called to handle deserialisation of an Animal over the wire, Jackson needs to work out what’s the \"message inside the envelope?\" Is it an IntergalacticAnimal, or is it a ProvincialAnimal? Without this knowledge, Jackson can’t instantiate the right kind of object.\nThere is a (truly excellent) resource, Deserialize JSON with Jackson into Polymorphic Types - A Complete Example, which describes how to do this using JsonTypeInfo, but it was written in 2011 for Jackson 1.7.\nState of the Art You may have missed the 2.12.0 release of Jackson Databind in Novemeber 2020. The world was generally busy with other things around then. In which case the JsonTypeInfo.Id#DEDUCTION could have slipped by you unnoticed.\nThe newer \"deduction\" mode takes away the need to tell Jackson how to read the incoming data; instead Jackson will take a list of possible choices you give it, and it will determine the best match for deserialisation.\nWhat does that look like? You can follow these steps:\nadd @JsonTypeInfo(use = DEDUCTION) to the envelope property\nadd @JsonSubTypes(@Type(...))\nHere is our updated example code.\nrecord AnimalSpottedEvent\u003cA extends Animal\u003e( Instant created, @JsonTypeInfo(use = DEDUCTION) @JsonSubTypes({ @Type(IntergalacticAnimal.class), @Type(ProvincialAnimal.class)}) A animal) {} interface Animal {} record IntergalacticAnimal(String galaxy, String name) implements Animal {} record ProvincialAnimal(String province, String name) implements Animal {} I’ve created a demo project as a companion to provide a working example.\nHappy deserialisation!\nAppendix Dependencies jackson-annotations provides @JsonTypeInfo and associated annotations which you’ll use in your transport code.\njackson-databind provides the \"invisible\" deserialisers. You’ll need these available on the classpath in your server or client application.\nThere are any number of ways to get jackson-annotations and jackson-databind on your classpath. spring-boot-starter-web includes many Jackson components; alternatively the Jackson project provides a BOM.\n","wordCount":"465","inLanguage":"en","image":"https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/cover.jpeg","datePublished":"2024-05-30T00:00:00Z","dateModified":"2024-05-30T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/using-jackson-deduction-to-simplify-deserialisation/"},"publisher":{"@type":"Organization","name":"tomregan.github.io","logo":{"@type":"ImageObject","url":"https://tomregan.github.io/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomregan.github.io/ accesskey=h title="tomregan.github.io (Alt + H)">tomregan.github.io</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://tomregan.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://tomregan.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tomregan.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://tomregan.github.io/posts/>Posts</a></div><h1 class=post-title>Using Jackson Deduction to Simplify Deserialisation</h1><div class=post-meta><span title='2024-05-30 00:00:00 +0000 UTC'>30 May 2024</span>&nbsp;·&nbsp;465 words</div></header><figure class=entry-cover><img loading=lazy src=https://tomregan.github.io/posts/2024-05-30-using-jackson-deduction-to-simplify-deserialisation/cover.jpeg alt></figure><div class=post-content><p>I find the documentation for Jackson is on the terse side, and dare I
say obstructively self-referential. If you aren&rsquo;t moved fully to tears
by the Javadoc entries for <code>JsonTypeInfo.As</code>, you deserve an ACM award.</p><p>In short: I need a helpful and up-to-date guide, so I&rsquo;m writing one.</p><h1 id=_what_are_we_trying_to_do>What are we trying to do?<a hidden class=anchor aria-hidden=true href=#_what_are_we_trying_to_do>#</a></h1><p>We often want to vary the content of our JSON. It&rsquo;s integral to the
<a href=https://www.enterpriseintegrationpatterns.com/patterns/messaging/EnvelopeWrapper.html>Envelope pattern</a>
for instance. Varying the content looks like this.</p><p>Here&rsquo;s an example of an intergalactic animal.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;created&#34;</span>: <span style=color:#e6db74>&#34;1977-05-25T12:00:00Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;animal&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;galaxy&#34;</span>: <span style=color:#e6db74>&#34;Far Far Away&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Womp Rat&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And here&rsquo;s an example of a provincial animal.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;created&#34;</span>: <span style=color:#e6db74>&#34;1835-09-15T06:00:00Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;animal&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;province&#34;</span>: <span style=color:#e6db74>&#34;Galápagos Islands&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Galápagos tortoise&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In our Java code, we want to be able to deserialise Animals, and we want
to handle either <code>IntergalacticAnimals</code>, or <code>ProvincialAnimals</code>. We
might write some transport code that looks like this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>record</span> <span style=color:#a6e22e>AnimalSpottedEvent</span><span style=color:#f92672>&lt;</span>A <span style=color:#66d9ef>extends</span> Animal<span style=color:#f92672>&gt;</span>(Instant created, A animal) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Animal</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>record</span> <span style=color:#a6e22e>IntergalacticAnimal</span>(String galaxy, String name) <span style=color:#66d9ef>implements</span> Animal {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>record</span> <span style=color:#a6e22e>ProvincialAnimal</span>(String province, String name) <span style=color:#66d9ef>implements</span> Animal {}
</span></span></code></pre></div><p>When it&rsquo;s called to handle deserialisation of an Animal over the wire,
Jackson needs to work out what&rsquo;s the "message inside the envelope?" Is
it an <code>IntergalacticAnimal</code>, or is it a <code>ProvincialAnimal</code>? Without this
knowledge, Jackson can&rsquo;t instantiate the right kind of object.</p><p>There is a (truly excellent) resource, <a href=https://programmerbruce.blogspot.com/2011/05/deserialize-json-with-jackson-into.html>Deserialize JSON with Jackson
into Polymorphic Types - A Complete
Example</a>,
which describes how to do this using <code>JsonTypeInfo</code>, but it was written
in 2011 for Jackson 1.7.</p><h1 id=_state_of_the_art>State of the Art<a hidden class=anchor aria-hidden=true href=#_state_of_the_art>#</a></h1><p>You may have missed the 2.12.0 release of Jackson Databind in Novemeber
2020. The world was generally busy with other things around then. In
which case the
<a href=https://fasterxml.github.io/jackson-annotations/javadoc/2.12/com/fasterxml/jackson/annotation/JsonTypeInfo.Id.html#DEDUCTION><code>JsonTypeInfo.Id#DEDUCTION</code></a>
could have slipped by you unnoticed.</p><p>The newer "deduction" mode takes away the need to tell Jackson <em>how</em>
to read the incoming data; instead Jackson will take a list of possible
choices you give it, and it will determine the best match for
deserialisation.</p><p>What does that look like? You can follow these steps:</p><ol><li><p>add <code>@JsonTypeInfo(use = DEDUCTION)</code> to the envelope property</p></li><li><p>add <code>@JsonSubTypes(@Type(...))</code></p></li></ol><p>Here is our updated example code.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>record</span> <span style=color:#a6e22e>AnimalSpottedEvent</span><span style=color:#f92672>&lt;</span>A <span style=color:#66d9ef>extends</span> Animal<span style=color:#f92672>&gt;</span>(
</span></span><span style=display:flex><span>        Instant created,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@JsonTypeInfo</span>(use <span style=color:#f92672>=</span> DEDUCTION)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@JsonSubTypes</span>({
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>@Type</span>(IntergalacticAnimal.<span style=color:#a6e22e>class</span>),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>@Type</span>(ProvincialAnimal.<span style=color:#a6e22e>class</span>)})
</span></span><span style=display:flex><span>        A animal) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Animal</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>record</span> <span style=color:#a6e22e>IntergalacticAnimal</span>(String galaxy, String name) <span style=color:#66d9ef>implements</span> Animal {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>record</span> <span style=color:#a6e22e>ProvincialAnimal</span>(String province, String name) <span style=color:#66d9ef>implements</span> Animal {}
</span></span></code></pre></div><p><a href=https://github.com/TomRegan/jackson-deduction-demo>I&rsquo;ve created a demo
project</a> as a
companion to provide a working example.</p><p>Happy deserialisation!</p><h1 id=_appendix>Appendix<a hidden class=anchor aria-hidden=true href=#_appendix>#</a></h1><h2 id=_dependencies>Dependencies<a hidden class=anchor aria-hidden=true href=#_dependencies>#</a></h2><p><code>jackson-annotations</code> provides <code>@JsonTypeInfo</code> and associated
annotations which you&rsquo;ll use in your transport code.</p><p><code>jackson-databind</code> provides the "invisible" deserialisers. You&rsquo;ll need
these available on the classpath in your server or client application.</p><p>There are any number of ways to get <code>jackson-annotations</code> and
<code>jackson-databind</code> on your classpath. <code>spring-boot-starter-web</code> includes
many Jackson components; alternatively the Jackson project provides a
<a href=https://mvnrepository.com/artifact/com.fasterxml.jackson/jackson-bom>BOM</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://tomregan.github.io/tags/java/>Java</a></li><li><a href=https://tomregan.github.io/tags/jackson/>Jackson</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tomregan.github.io/>tomregan.github.io</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>